<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Favicons -->
<link rel="icon" type="image/png" sizes="32x32" href="image/attendancelogo.png?v=1">
<link rel="icon" type="image/png" sizes="16x16" href="image/attendancelogo.png?v=1">
<link rel="shortcut icon" href="image/attendancelogo.png?v=1">

<title>ChronoPay - Change Password</title>

<style>
  body, html {
    margin:0; padding:0; font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #6b73ff 0%, #000dff 100%);
    display:flex; justify-content:center; align-items:center; height:100vh;
  }
  body::before, body::after {
    content: ''; position: fixed; border-radius: 50%;
    opacity: 0.15; filter: blur(100px); z-index: 0;
  }
  body::before { width: 300px; height: 300px; background: #ff6b6b; top: 20%; left: 10%; }
  body::after { width: 400px; height: 400px; background: #ffd93b; bottom: 10%; right: 15%; }

  .container {
    background: rgba(255,255,255,0.95); padding:30px 40px; border-radius:12px;
    box-shadow:0 8px 24px rgba(0,0,0,0.15); max-width:400px; width:90%;
    z-index:1; position:relative;
  }
  h1 { text-align:center; color:#2c3e50; margin-bottom:20px; }
  label { display:block; margin-top:10px; font-weight:600; }
  input {
    width:100%; padding:10px; margin-top:6px;
    border-radius:6px; border:1px solid #ccc;
  }
  button {
    margin-top:20px; padding:12px; background:#007bff; color:white;
    border:none; border-radius:6px; cursor:pointer; width:100%;
  }
  button:hover { background:#0056b3; }
  .links { text-align:center; margin-top:15px; font-size:0.9rem; }
  .links a { color:#007bff; text-decoration:none; }
  .links a:hover { text-decoration:underline; }

  .message {
    text-align: center;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 18px;
    font-weight: 600;
    display: none;
  }
  .message.success { background-color: #d4edda; color: #155724; }
  .message.error { background-color: #f8d7da; color: #721c24; }
</style>
</head>
<body>
<div class="container">
  <h1>Change Password</h1>
  <form id="changePasswordForm">
    <div id="messageBox" class="message"></div>

    <label for="email">Email</label>
    <input type="email" id="email" placeholder="Enter your email" required>

    <label for="currentPassword">Current Password</label>
    <input type="password" id="currentPassword" placeholder="Enter current password" required>

    <label for="newPassword">New Password</label>
    <input type="password" id="newPassword" placeholder="Enter new password" required>

    <button type="submit">Update Password</button>
  </form>

  <div class="links">
    <a href="index.html">Back to Login</a>
  </div>
</div>

<!-- Firebase v12 Modular SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, updatePassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCchBXnuc11KzkpG720IPtWb7Y1MKO0OTU",
  authDomain: "chronopay-b4267.firebaseapp.com",
  projectId: "chronopay-b4267",
  storageBucket: "chronopay-b4267.firebasestorage.app",
  messagingSenderId: "335594235253",
  appId: "1:335594235253:web:48c2581cfaabb143731f3c",
  measurementId: "G-GPY64CKF0Z"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const form = document.getElementById('changePasswordForm');
const messageBox = document.getElementById('messageBox');

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const email = document.getElementById('email').value.trim();
  const currentPassword = document.getElementById('currentPassword').value;
  const newPassword = document.getElementById('newPassword').value;

  try {
    // Re-authenticate user
    const userCredential = await signInWithEmailAndPassword(auth, email, currentPassword);
    const user = userCredential.user;

    // Update password
    await updatePassword(user, newPassword);

    messageBox.textContent = "✅ Password updated successfully!";
    messageBox.className = "message success";
    messageBox.style.display = "block";
    form.reset();

  } catch (error) {
    console.error(error);
    messageBox.textContent = "❌ " + (error.code === "auth/wrong-password" ? "Invalid credentials, please try again." : error.message);
    messageBox.className = "message error";
    messageBox.style.display = "block";
  }
});
</script>
</body>
</html>
